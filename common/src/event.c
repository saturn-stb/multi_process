/******************************************************************************
*
* event.c
*
* Description	:
*
* Author		: 
* First Created : 2026.01.31
*
* Copyleft (c) 2026 Every Rights Released.
* All Rights Reversed. 누구나 자유롭게 사용, 수정 및 배포할 수 있습니다.
* 이 소프트웨어는 공유의 가치를 위해 조건 없이 제공됩니다.
*
*****************************************************************************/
#include <ctype.h>
#include <stdio.h>
#include <string.h> 
#include <stdlib.h>
#include <time.h>
#include <ctype.h>

#include "event.h" 

/******************************************************************************
*
*
*
*****************************************************************************/
/*-----------------------------------------------------------------------------
*
*
*
*---------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
*
*
*
*---------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
*
*
*
*---------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
*
*
*
*---------------------------------------------------------------------------*/
	
/******************************************************************************
*
*
*
*****************************************************************************/
/*-----------------------------------------------------------------------------
*
*
*
*---------------------------------------------------------------------------*/
int Event_Create(Event_t* ev, const char* name) 
{
    // 세마포어를 0으로 초기화하여 생성 (누군가 Set하기 전까지 Wait에서 대기)
    ev->sem = sem_open(name, O_CREAT, 0666, 0);
    if (ev->sem == SEM_FAILED) return -1;
    snprintf(ev->name, sizeof(ev->name), "%s", name);
    return 0;
}

/*-----------------------------------------------------------------------------
*
*
*
*---------------------------------------------------------------------------*/
void Event_Wait(Event_t* ev) 
{
    if (ev && ev->sem) sem_wait(ev->sem);
}

/*-----------------------------------------------------------------------------
*
*
*
*---------------------------------------------------------------------------*/
void Event_Set(Event_t* ev) 
{
    if (!ev || !ev->sem) return;
    int val;
    sem_getvalue(ev->sem, &val);
    if (val <= 0) sem_post(ev->sem); // 이미 신호가 있으면 중복 포스팅 방지
}

/*-----------------------------------------------------------------------------
*
*
*
*---------------------------------------------------------------------------*/
void Event_Close(Event_t* ev) 
{
    if (ev && ev->sem) 
	{
        sem_close(ev->sem);
        sem_unlink(ev->name);
    }
}

